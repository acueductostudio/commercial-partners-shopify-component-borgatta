<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizaci√≥n Component - Unificado</title>
    
    <!-- Estilos principales -->
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
           
        }
        
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 24px;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.8;
        }
        
        /* PANEL DE CONTROLES - SOLO PARA DESARROLLO */
        .dev-controls {
            background: #34495e;
            color: white;
            padding: 20px;
            border-bottom: 1px solid #2c3e50;
        }
        
        .dev-controls h3 {
            margin: 0 0 15px 0;
            color: #ecf0f1;
        }
        
        .control-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .control-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .control-group input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn.secondary {
            background: #95a5a6;
        }
        
        .btn.secondary:hover {
            background: #7f8c8d;
        }
        
        .btn.success {
            background: #27ae60;
        }
        
        .btn.success:hover {
            background: #229954;
        }
        
        .btn.warning {
            background: #f39c12;
        }
        
        .btn.warning:hover {
            background: #e67e22;
        }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status.mock {
            background: #f39c12;
            color: white;
        }
        
        .status.production {
            background: #27ae60;
            color: white;
        }
        
        /* CONTENIDO PRINCIPAL */
        
        
        .component-wrapper {
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            .control-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .dev-controls {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">

        <!-- PANEL DE CONTROLES - SOLO PARA DESARROLLO 

        DESARROLLO: Descomenta esta secci√≥n para controles de prueba
        PRODUCCI√ìN: Comenta esta secci√≥n completa
       
        <div class="dev-controls">
            <h3>üß™ Panel de Desarrollo</h3>
            
            <div class="control-group">
                <label>
                    <input type="checkbox" id="mockModeCheckbox">
                    <span>Modo Mock (datos de prueba)</span>
                </label>
                <span id="mockStatus" class="status mock">MOCK</span>
            </div>
            
            <div class="control-group">
                <button class="btn" onclick="loadDepositoData()">üì¶ Cargar Datos Dep√≥sito</button>
                <button class="btn" onclick="loadAsesorData()">üë§ Cargar Datos Asesor</button>
                <button class="btn secondary" onclick="clearComponent()">üóëÔ∏è Limpiar</button>
            </div>
            
            <div class="control-group">
                <button class="btn warning" onclick="showDebugInfo()">üîç Debug Info</button>
                <button class="btn success" onclick="toggleMockMode()">üîÑ Cambiar Modo</button>
                <button class="btn" onclick="testReact()">üß™ Test React</button>
                <button class="btn secondary" onclick="checkComponentStatus()">üìã Estado del Componente</button>
            </div>
        </div>

         PANEL DE CONTROLES - SOLO PARA DESARROLLO -->
       
        
        <!-- CONTENIDO PRINCIPAL -->
        <div class="main-content">
            <div id="cotizacion-root" class="component-wrapper">
                <!-- El componente React se montar√° aqu√≠ -->
            </div>
        </div>
    </div>
    
    <!-- Importar el componente React 
    <script type="module">
        // Importar el componente principal
        async function loadComponent() {
            try {
                console.log('üîÑ Intentando importar src/index.js...');
                await import('./src/index.js');
                console.log('‚úÖ M√≥dulo src/index.js importado correctamente');
                
                // Verificar que se expuso correctamente
                console.log('üîç window.CotizacionComponent despu√©s del import:', window.CotizacionComponent);
            } catch (error) {
                console.error('‚ùå Error al importar src/index.js:', error);
                console.error('‚ùå Stack trace:', error.stack);
            }
        }
        
        // Ejecutar la carga del componente
        loadComponent();
        
        // ========================================
        // CONFIGURACI√ìN DE DESARROLLO
        // ========================================
        
        // Datos de prueba
        const TEST_DATA = {
            DEPOSITO_BASICO: {
                role: "Deposito",
                idCliente: "D-123574654",
                email: "deposito@test.com",
                productos: [
                    {
                        variantId: 123456789,
                        title: "Producto Test Dep√≥sito",
                        sku: "SKU-DEP-001",
                        quantity: 2
                    }
                ],
                totalItems: 2,
                totalPrice: 150.00
            },
            
            ASESOR_BASICO: {
                role: "Asesor",
                idCliente: "A-454654654",
                email: "asesor@test.com",
                productos: [
                    {
                        variantId: 987654321,
                        title: "Producto Test Asesor",
                        sku: "SKU-ASE-001",
                        quantity: 1
                    }
                ],
                totalItems: 1,
                totalPrice: 75.50
            }
        };
        
        // Variables globales
        let currentComponent = null;
        let isMockMode = true;
        
        // ========================================
        // FUNCIONES DE CONTROL
        // ========================================
        
        window.loadDepositoData = async function() {
            console.log('üì¶ Cargando datos de Dep√≥sito...');
            console.log('üì¶ Datos:', TEST_DATA.DEPOSITO_BASICO);
            
            try {
                // Importar el componente directamente
                if (!window.CotizacionComponent) {
                    console.log('üì¶ Importando componente...');
                    await import('./src/index.js');
                    await new Promise(resolve => setTimeout(resolve, 500)); // Esperar un poco
                }
                
                console.log('üì¶ window.CotizacionComponent:', window.CotizacionComponent);
                
                if (!window.CotizacionComponent || !window.CotizacionComponent.initializeCotizacionComponent) {
                    throw new Error('El componente no est√° disponible despu√©s de la importaci√≥n');
                }
                
                initializeComponent(TEST_DATA.DEPOSITO_BASICO);
            } catch (error) {
                console.error('‚ùå Error cargando datos de Dep√≥sito:', error);
                alert('‚ùå Error: ' + error.message);
            }
        };
        
        window.loadAsesorData = async function() {
            console.log('üë§ Cargando datos de Asesor...');
            console.log('üë§ Datos:', TEST_DATA.ASESOR_BASICO);
            
            try {
                // Importar el componente directamente
                if (!window.CotizacionComponent) {
                    console.log('üë§ Importando componente...');
                    await import('./src/index.js');
                    await new Promise(resolve => setTimeout(resolve, 500)); // Esperar un poco
                }
                
                console.log('üë§ window.CotizacionComponent:', window.CotizacionComponent);
                
                if (!window.CotizacionComponent || !window.CotizacionComponent.initializeCotizacionComponent) {
                    throw new Error('El componente no est√° disponible despu√©s de la importaci√≥n');
                }
                
                initializeComponent(TEST_DATA.ASESOR_BASICO);
            } catch (error) {
                console.error('‚ùå Error cargando datos de Asesor:', error);
                alert('‚ùå Error: ' + error.message);
            }
        };
        
        window.clearComponent = function() {
            console.log('üóëÔ∏è Limpiando componente...');
            if (window.CotizacionComponent && window.CotizacionComponent.cleanupCotizacionComponent) {
                window.CotizacionComponent.cleanupCotizacionComponent('cotizacion-root');
            }
            currentComponent = null;
        };
        
        window.toggleMockMode = function() {
            if (window.CotizacionComponent && window.CotizacionComponent.setMockMode) {
                isMockMode = !isMockMode;
                window.CotizacionComponent.setMockMode(isMockMode, true);
                updateMockStatus();
                syncMockModeCheckbox();
                console.log(`üîÑ Modo cambiado a: ${isMockMode ? 'MOCK' : 'PRODUCCI√ìN'}`);
            }
        };
        
        window.showDebugInfo = function() {
            if (window.CotizacionComponent && window.CotizacionComponent.getDebugInfo) {
                const info = window.CotizacionComponent.getDebugInfo();
                console.log('üîç Debug Info:', info);
                alert(`Debug Info:\n\nActive Roots: ${info.activeRoots}\nMock Mode: ${info.mockMode}\n\nVer consola para m√°s detalles.`);
            }
        };
        
        window.checkComponentStatus = function() {
            console.log('üìã Verificando estado del componente...');
            console.log('üìã window.CotizacionComponent:', window.CotizacionComponent);
            console.log('üìã typeof window.CotizacionComponent:', typeof window.CotizacionComponent);
            
            if (window.CotizacionComponent) {
                console.log('‚úÖ CotizacionComponent est√° disponible');
                console.log('üìã Propiedades:', Object.keys(window.CotizacionComponent));
                console.log('üìã initializeCotizacionComponent:', window.CotizacionComponent.initializeCotizacionComponent);
                console.log('üìã cleanupCotizacionComponent:', window.CotizacionComponent.cleanupCotizacionComponent);
                console.log('üìã setMockMode:', window.CotizacionComponent.setMockMode);
                
                alert('‚úÖ Componente Cargado\n\nPropiedades disponibles:\n' + Object.keys(window.CotizacionComponent).join('\n'));
            } else {
                console.error('‚ùå CotizacionComponent NO est√° disponible');
                alert('‚ùå Componente NO Cargado\n\nRevisa la consola para m√°s detalles.');
            }
        };
        
        // Test simple de React - funci√≥n global
        window.testReact = async function() {
            const container = document.getElementById('cotizacion-root');
            
            try {
                console.log('üß™ Iniciando test de React...');
                
                // Limpiar contenedor
                if (container) {
                    container.innerHTML = '';
                }
                
                console.log('üß™ Importando m√≥dulos...');
                const [ReactModule, ReactDOMModule] = await Promise.all([
                    import('react'),
                    import('react-dom/client')
                ]);
                
                console.log('‚úÖ M√≥dulos importados');
                console.log('üîç Keys de ReactModule:', Object.keys(ReactModule));
                console.log('üîç Keys de ReactDOMModule:', Object.keys(ReactDOMModule));
                console.log('üîç ReactModule.default:', ReactModule.default);
                console.log('üîç ReactModule.createElement:', ReactModule.createElement);
                
                // Determinar c√≥mo acceder a React
                const React = ReactModule.default || ReactModule;
                console.log('üîç React final:', React);
                console.log('üîç React.createElement:', React?.createElement);
                
                // Determinar c√≥mo acceder a createRoot
                const createRoot = ReactDOMModule.createRoot || ReactDOMModule.default?.createRoot;
                
                if (!createRoot) {
                    throw new Error('createRoot no est√° disponible en react-dom/client');
                }
                
                console.log('‚úÖ createRoot encontrado');
                
                if (!React || !React.createElement) {
                    throw new Error('React.createElement no est√° disponible. React: ' + JSON.stringify(Object.keys(React || {})));
                }
                
                console.log('‚úÖ React.createElement encontrado');
                
                if (!container) {
                    throw new Error('Contenedor cotizacion-root no encontrado');
                }
                
                // Crear componente de test simple
                const TestDiv = React.createElement('div', {
                    style: { 
                        padding: '20px', 
                        backgroundColor: '#4caf50', 
                        margin: '20px 0',
                        border: '3px solid #2e7d32',
                        borderRadius: '8px',
                        fontSize: '18px',
                        fontWeight: 'bold',
                        color: 'white',
                        textAlign: 'center'
                    }
                }, '‚úÖ React est√° funcionando correctamente!');
                
                // Crear root y renderizar
                console.log('üéØ Creando root de React...');
                const root = createRoot(container);
                
                console.log('üéØ Renderizando componente...');
                root.render(TestDiv);
                
                console.log('‚úÖ Test completado exitosamente!');
                
                // Verificar contenido despu√©s de render
                setTimeout(() => {
                    console.log('üîç HTML renderizado:', container.innerHTML);
                }, 500);
                
            } catch (error) {
                console.error('‚ùå Error en test de React:', error);
                console.error('‚ùå Mensaje:', error?.message || 'Sin mensaje');
                console.error('‚ùå Stack:', error?.stack || 'Sin stack');
                
                // Mostrar error en la p√°gina
                if (container) {
                    container.innerHTML = `
                        <div style="padding: 20px; background: #ffebee; border: 2px solid #f44336; border-radius: 8px; color: #c62828;">
                            <h3>‚ùå Error en Test de React</h3>
                            <p><strong>Mensaje:</strong> ${error?.message || 'Error desconocido'}</p>
                            <pre style="background: #fff; padding: 10px; border-radius: 4px; overflow: auto;">${error?.stack || 'Sin stack trace'}</pre>
                        </div>
                    `;
                }
            }
        };
        
        function initializeComponent(props) {
            console.log('üöÄ Inicializando componente con props:', props);
            
            // Verificar que el contenedor existe
            const container = document.getElementById('cotizacion-root');
            console.log('üîç Contenedor encontrado:', container);
            
            if (!container) {
                console.error('‚ùå Contenedor cotizacion-root no encontrado');
                alert('Error: Contenedor del componente no encontrado.');
                return;
            }
            
            if (window.CotizacionComponent && window.CotizacionComponent.initializeCotizacionComponent) {
                // Limpiar componente anterior si existe
                clearComponent();
                
                console.log('üîÑ Llamando a initializeCotizacionComponent...');
                
                // Inicializar nuevo componente - orden correcto: props primero, luego containerId
                currentComponent = window.CotizacionComponent.initializeCotizacionComponent(
                    props,
                    'cotizacion-root'
                );
                
                console.log('‚úÖ Componente inicializado:', currentComponent);
                
                // Verificar que el componente se renderiz√≥
                setTimeout(() => {
                    const renderedContent = document.querySelector('#cotizacion-root > *');
                    console.log('üîç Contenido renderizado:', renderedContent);
                    if (!renderedContent) {
                        console.warn('‚ö†Ô∏è No se detect√≥ contenido renderizado en el contenedor');
                    }
                }, 1000);
            } else {
                console.error('‚ùå CotizacionComponent no est√° disponible');
                console.log('üîç window.CotizacionComponent:', window.CotizacionComponent);
                alert('Error: El componente no est√° cargado correctamente. Revisa la consola para m√°s detalles.');
            }
        }
        
        function updateMockStatus() {
            const statusElement = document.getElementById('mockStatus');
            if (statusElement) {
                if (isMockMode) {
                    statusElement.textContent = 'MOCK';
                    statusElement.className = 'status mock';
                } else {
                    statusElement.textContent = 'PRODUCCI√ìN';
                    statusElement.className = 'status production';
                }
            }
        }
        
        function syncMockModeCheckbox() {
            const checkbox = document.getElementById('mockModeCheckbox');
            if (checkbox) {
                checkbox.checked = isMockMode;
            }
        }
        
        // ========================================
        // EVENT LISTENERS
        // ========================================
        
        // Checkbox de modo mock
        document.getElementById('mockModeCheckbox')?.addEventListener('change', function(e) {
            if (window.CotizacionComponent && window.CotizacionComponent.setMockMode) {
                isMockMode = e.target.checked;
                window.CotizacionComponent.setMockMode(isMockMode, true);
                updateMockStatus();
                console.log(`üîÑ Modo mock: ${isMockMode ? 'ACTIVADO' : 'DESACTIVADO'}`);
            }
        });
        
        // ========================================
        // INICIALIZACI√ìN
        // ========================================
        
        // Esperar a que el componente est√© cargado
        let waitAttempts = 0;
        const MAX_WAIT_ATTEMPTS = 20; // 10 segundos m√°ximo
        
        function waitForComponent() {
            waitAttempts++;
            console.log(`üîç Verificando disponibilidad del componente... (intento ${waitAttempts}/${MAX_WAIT_ATTEMPTS})`);
            console.log('üîç window.CotizacionComponent:', window.CotizacionComponent);
            console.log('üîç typeof window.CotizacionComponent:', typeof window.CotizacionComponent);
            
            if (window.CotizacionComponent) {
                console.log('‚úÖ CotizacionComponent encontrado!');
                console.log('üîç M√©todos disponibles:', Object.keys(window.CotizacionComponent));
                console.log('üîç initializeCotizacionComponent:', typeof window.CotizacionComponent.initializeCotizacionComponent);
                
                // Configurar modo mock inicial
                if (window.CotizacionComponent.setMockMode) {
                    window.CotizacionComponent.setMockMode(isMockMode, false);
                    console.log('‚úÖ Modo mock configurado');
                }
                
                updateMockStatus();
                syncMockModeCheckbox();
                
                console.log('‚úÖ Componente listo para usar!');
                console.log('üëâ Haz clic en "üì¶ Cargar Datos Dep√≥sito" o "üë§ Cargar Datos Asesor" para empezar');
                
            } else {
                if (waitAttempts < MAX_WAIT_ATTEMPTS) {
                    console.log('‚è≥ Esperando CotizacionComponent...');
                    setTimeout(waitForComponent, 500);
                } else {
                    console.error('‚ùå Timeout: El componente no se carg√≥ despu√©s de ' + (MAX_WAIT_ATTEMPTS * 0.5) + ' segundos');
                    alert('‚ùå Error: El componente no se pudo cargar. Por favor, recarga la p√°gina.');
                }
            }
        }
        
        
        // Inicializar cuando el DOM est√© listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                // NO ejecutar testReact autom√°ticamente - solo esperar el componente
                waitForComponent();
            });
        } else {
            waitForComponent();
        }
        
        // ========================================
        // CONFIGURACI√ìN PARA PRODUCCI√ìN
        // ========================================
        
        /*
        PARA USAR EN PRODUCCI√ìN (Shopify):
        
        1. Comenta toda la secci√≥n "dev-controls" en el HTML
        2. Comenta todo este script de desarrollo
        3. Descomenta y configura el script de producci√≥n abajo:
        
        <script type="module">
            import './src/index.js';
            
            // Datos reales de Shopify
            const shopifyData = {
                role: "{{ customer.tags }}",
                idCliente: "{{ customer.default_address.company }}",
                email: "{{ customer.email }}",
                productos: [
                    {% for item in cart.items %}
                    {
                        variantId: {{ item.variant_id }},
                        title: "{{ item.title }}",
                        sku: "{{ item.sku }}",
                        quantity: {{ item.quantity }}
                    }{% unless forloop.last %},{% endunless %}
                    {% endfor %}
                ],
                totalItems: {{ cart.item_count }},
                totalPrice: {{ cart.total_price | money_without_currency }}
            };
            
            // Inicializar componente cuando est√© listo
            function initializeProductionComponent() {
                if (window.CotizacionComponent) {
                    window.CotizacionComponent.initializeCotizacionComponent(
                        'cotizacion-root',
                        shopifyData
                    );
                } else {
                    setTimeout(initializeProductionComponent, 100);
                }
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeProductionComponent);
            } else {
                initializeProductionComponent();
            }
        */
    </script>
    -->
</body>
</html>